#!/usr/bin/env ruby

SOURCE = './bin/l4d2-observer'
TARGET = '/home/steam/.local/bin/l4d2-observer'

def compile(file, writer)
  File.open(file, 'r') do |reader|
    while line = reader.gets
      # require_relative
      if line =~ /^\s*require_relative\s+["'](.*)["']\s*$/
        writer.puts "# START: #{line}"
        dir = File.dirname file
        path = File.expand_path File.join dir, $1
        compile(path, writer)
        writer.puts "# END: #{line}"
      else
        writer.puts line
      end
    end
  end
end

File.open(TARGET, 'w') do |writer|
  compile(SOURCE, writer)
end
system "chown steam #{TARGET}"
system "chgrp steam #{TARGET}"
system "chmod u+x #{TARGET}"
